var Playlist=function(){var a=true;var c="playlists.php";var b="loadfile.php";return{_playlist:[],_playingIdx:-1,init:function(){Playlist.reload()},addItem:function(d){d.type="sound";d.start="0";d.file=b+"?d="+encodeURIComponent(d.file);Playlist._playlist.push(d);Playlist.refresh(true)},allowRefresh:function(d){a=true;if(d){Playlist.refresh(true)}},clear:function(){$("#savedPlaylistsItems").attr("selectedIndex","0");Playlist._playlist=[];Playlist._playingIdx=-1;Playlist.refresh()},highlightPlaying:function(){$(".nowPlaying").removeClass("nowPlaying");$("#playlistItem_"+Playlist._playingIdx).addClass("nowPlaying")},holdRefresh:function(){a=false},load:function(){var e=$("#savedPlaylistsItems").val();if(e=="_new"){Playlist.clear()}else{var d=c+"/"+encodeURIComponent(e);$.get(d,function(f,g){Playlist._playlist=JSON.parse(f);Playlist.refresh()})}},refresh:function(e){if(a){var d=Template.processTemplate("playlistTemplate",{items:Playlist._playlist});$("#playlist").html(d);$("#playlistItems").sortable({axis:"y",opacity:0.75,update:function(j,k){var i=[];var h=$("#playlistItems").sortable("toArray");for(var l=0;l<h.length;l++){var g=h[l];if($("#"+g).hasClass("nowPlaying")){Playlist._playingIdx=l}var f=g.substring(g.indexOf("_")+1);i[l]=Playlist._playlist[f]}Playlist._playlist=i;Playlist.refresh(true)}});if(e){Playlist.highlightPlaying()}}},reload:function(){$.getJSON(c,function(e){var d=Template.processTemplate("savedPlaylistsTemplate",e);$("#savedPlaylists").html(d)})},remove:function(){var e=$("#savedPlaylistsItems").val();if(e!="_new"){var d=c+"/"+e;$.delete_(d,function(){Playlist.reload()})}},removeItem:function(d){if(d>=0&&d<Playlist._playlist.length){var e=true;if(d==Playlist._playingIdx){e=false}if(d<=Playlist._playingIdx){Playlist._playingIdx--}Playlist._playlist.splice(d,1);Playlist.refresh(e)}},save:function(){var d=$("#savedPlaylistsItems :selected").val();if(d=="_new"){d="";while(d==""){d=prompt("Please provide a name for this playlist")}}if(d!=null){var e=JSON.stringify(Playlist._playlist);$.post(c+"/"+d,{playlist:e},function(){Playlist.reload()})}}}}();$(document).ready(function(){Playlist.init()});
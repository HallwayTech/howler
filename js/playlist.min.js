var Playlist=function(){var a=true;var c="playlists.php";var b="loadfile.php";return{_playlist:[],_playingIdx:-1,init:function(){Playlist.reload()},addItem:function(d){d.type="sound";d.start="0";d.file=b+"?d="+encodeURIComponent(d.file);Playlist._playlist.push(d);Playlist.refresh(true)},allowRefresh:function(d){a=true;if(d){Playlist.refresh(true)}},clear:function(){$("#saved_playlists .items").attr("selectedIndex","0");Playlist._playlist=[];Playlist._playingIdx=-1;Playlist.refresh()},highlightPlaying:function(){if(Playlist._playingIdx>=0){$(".now_playing").removeClass("now_playing");$("#playlist_item_"+Playlist._playingIdx).addClass("now_playing");var e=$("#playlist").position()["top"];var g=$(".now_playing").position()["top"];var d=g-e;var f=$("#playlist").scrollTop();$("#playlist").scrollTop(f+d)}},holdRefresh:function(){a=false},load:function(e){if(!e){e=$("#saved_playlists .items").val()}if(e=="_new"){Playlist.clear()}else{var d=c+"/"+encodeURIComponent(e);$.ajax({type:"GET",dataType:"json",url:d,success:function(f,g){Playlist._playlist=f;Playlist.refresh()},error:function(f,g){alert("Unable to load playlist ["+e+"]")}})}},refresh:function(e){if(a){var d=Template.processTemplate("playlistTemplate",{items:Playlist._playlist});$("#playlist").html(d);$("#playlist .items").sortable({axis:"y",opacity:0.75,update:Playlist.updateSortable});if(e){Playlist.highlightPlaying()}}},reload:function(){$.ajax({type:"GET",dataType:"json",url:c,success:function(e,f){var d=Template.processTemplate("savedPlaylistsTemplate",e);$("#saved_playlists").html(d)},error:function(d,e){alert("Unable to get playlists.")}})},remove:function(e){if(!e){e=$("#saved_playlists .items").val()}if(e!="_new"){var d=c+"/"+e;$.ajax({type:"DELETE",url:d,success:function(){Playlist.reload()},error:function(){alert("Unable to delete playlist ["+e+"]")}})}},removeItem:function(d){if(d>=0&&d<Playlist._playlist.length){var e=true;if(d==Playlist._playingIdx){e=false}if(d<=Playlist._playingIdx){Playlist._playingIdx--}Playlist._playlist.splice(d,1);Playlist.refresh(e)}},save:function(d){if(!d){d=$("#saved_playlists .items :selected").val()}if(d=="_new"){d="";while(d==""){d=prompt("Please provide a name for this playlist.")}}if(d!=null){var e=JSON.stringify(Playlist._playlist);$.ajax({type:"POST",url:c+"/"+d,data:{playlist:e},success:function(){Playlist.reload()},error:function(){}})}},updateSortable:function(h,i){var g=[];var f=$("#playlist .items").sortable("toArray");for(var j=0;j<f.length;j++){var e=f[j];if($("#"+e).hasClass("now_playing")){Playlist._playingIdx=j}var d=e.substring(e.indexOf("_")+1);g[j]=Playlist._playlist[d]}Playlist._playlist=g;Playlist.refresh(true)}}}();$(document).ready(function(){Playlist.init()});